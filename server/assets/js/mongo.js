// Generated by CoffeeScript 1.4.0
var collData, getDocData, getMongoDoc, getMongoDocList, global_doc, mongoQuery, renderDoc;

global_doc = [];

mongoQuery = function(query, _success, _error) {
  var q;
  q = encodeURI(JSON.stringify(query));
  return $.ajax("http://localhost:27080/DEFT/docs/_find?criteria=" + q, {
    type: 'GET',
    dataType: 'jsonp',
    error: _error,
    success: _success
  });
};

getMongoDoc = function(id) {
  return mongoQuery({
    "_id": {
      "$oid": id
    }
  }, (function(data, textStatus, jqXHR) {
    console.log(data);
    global_doc = data.results[0];
    return renderDoc(data.results[0]);
  }), (function(jqXHR, textStatus, errorThrown) {
    console.log("AJAX Error: " + textStatus);
    return $("body").append('<h2><font color="red"> Could not find that document in the database. </font></h2>');
  }));
};

getMongoDocList = function(_success) {
  var q;
  q = encodeURI(JSON.stringify(["name"]));
  return $.ajax("http://localhost:27080/DEFT/docs/_find?fields=" + q, {
    type: 'GET',
    dataType: 'jsonp',
    error: function(jqXHR, textStatus, errorThrown) {
      console.log("AJAX Error: " + textStatus);
      return $("body").append('<h2><font color="red"> Could not connect to the database. </font></h2>');
    },
    success: _success
  });
};

getDocData = function(doc) {
  return {
    text: doc.text,
    entities: _.zip(_.map(_.range(doc.tstarts.length), function(elt) {
      return "T" + elt;
    }), doc.tpos, _.map(_.zip(doc.tstarts, _.map(_.zip(doc.tstarts, doc.tlengths), function(elt) {
      return elt[0] + elt[1];
    })), function(elt) {
      return [elt];
    }))
  };
};

collData = {
  entity_types: [
    {
      type: 'Person',
      labels: ['Person', 'Per'],
      bgColor: "#7fa2ff",
      borderColor: 'darken'
    }
  ]
};

renderDoc = function(doc) {
  return head.ready(function() {
    return Util.embed('pos-div', collData, getDocData(doc), webFontURLs);
  });
};
